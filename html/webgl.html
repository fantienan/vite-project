<!DOCTYPE html>
<html>
  <head>
    <title>Symbols with WebGL</title>

    <meta charset="UTF-8">
    <link rel="stylesheet" href="./ol.css" type="text/css">
    <!-- The line below is only needed for old environments like Internet Explorer and Android 4.x -->
    <script src="./ol/4.5.0/ol-debug.js"></script>
  </head>
  <body>
    <div id="map" class="map"></div>
    <div style="display: flex;gap: 10px;">
      <div id="total"></div>
      <select id="featuer-select">
        <option value="all">全部</option>
      </select>
      <button id="data-btn">获取数据</button>
      <button id="enable-btn">查看轨迹</button>
      <button id="clear-btn">清空轨迹</button>
      <div id="1to22-btn-group">
        <button id="7to12">查看7至12数据缓存分布</button>
        <button id="13to18">13至18数据缓存分布</button>
        <button id="19to22">19至22数据缓存分布</button>
      </div>
      <div style="display: flex;">
        要素数量<div id="num"></div>
        渲染时长<div id="ms"></div>
      </div>
      <div style="display: flex;">
        地图级别<div id="zoom"></div>
      </div>
      <div style="display: flex;">
        经纬度<div id="coord"></div>
      </div>

    </div>
    <script src="./ol/proj4.js"></script>
    <script src="./ol/proj4-ext.js"></script>
    <script src="./ol/jsts.min.js"></script>
    <script src="./layer-config.js"></script>
    <script src="./source-collection.js"></script>
    <script src="./layer-factory.js"></script>
    <script src="./helper.js"></script>
    <script>
      const helper = new Helper();
      helper.initMap(document.getElementById("map"));
      const clearBtn = document.getElementById("clear-btn");
      const dataBtn = document.getElementById("data-btn")
      const totalNode = document.getElementById('total');
      const featureSelect = document.getElementById('featuer-select');
      const enableBtn = document.getElementById("enable-btn")
      const msNode = document.getElementById("ms")
      const numNode = document.getElementById("num")
      const btnGroup = document.getElementById("1to22-btn-group");
      const _7to12Btn = document.getElementById("7to12");
      const _13to18Btn = document.getElementById("13to18");
      const _19to22Btn = document.getElementById("19to22");

      clearBtn.addEventListener("click", function() {
        helper.clear()
      });

      dataBtn.addEventListener("click", function() {
        fetch('../public/data/geojson/hu-lin-yuan.geojson').then(res => res.json()).then(res => {
          let value = 'all';
          helper.setPointSources(res)
          totalNode.innerHTML = `总共${res.features.length}条数据`
          // featureSelect.innerHTML =Array(Math.floor(res.features.length / 10000)).fill().map((item, index) => {
          //   if (index === 0) {
          //     return `<option value="all">全部</option>`
          //   }
          //   return `<option value="${index * 10000}">${`${index}万`}</option>`
          // }).join(''); 
          // featureSelect.addEventListener('change', (e) => {
          //   value = e.target.value
          //   helper.clear()
          // })
          enableBtn.addEventListener("click", function() {
            // let fs = value === 'all' ? features : features.slice(0,value);
            // let fsLength = fs.length
            const time = {start: Date.now()}
            const info = helper.renderPoints().then(info => {
              time.end = Date.now();
              time.duration = (time.end - time.start) / 1000 + '秒';
              msNode.innerHTML = time.duration;
              numNode.innerHTML = info.features.length;
            })
          })

          btnGroup.addEventListener("click", function(e) {
            if (e.target.id === '7to12') {
              helper.source7to12Collection.setActive(!helper.source7to12Collection.active)
            } else if (e.target.id === '13to18') {
              helper.source13to18Collection.setActive(!helper.source13to18Collection.active)
            } else if (e.target.id === '19to22') {
              helper.source19Collection.setActive(!helper.source19Collection.active)
            }
          })
        })
      })
    </script>
  </body>
</html>